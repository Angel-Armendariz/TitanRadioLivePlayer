<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Custom Radio Player</title>
    <style>
        #toggleButton {
            background-size: cover;
            width: 6rem;
            height: 5rem;
            border: none;
            outline: none;
            cursor: pointer;
        }

        .loading {
            background-image: url('https://titanradio.org/wp-content/uploads/2023/10/loadingButton.png');
        }

        .playing {
            background-image: url('https://titanradio.org/wp-content/uploads/2023/10/stopButton.png');
        }

        .stopped {
            background-image: url('https://titanradio.org/wp-content/uploads/2023/10/playButton.png');
        }
        .centered-div {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 7rem;
        }
    </style>
</head>
<body>
    <h2>Custom Radio Player</h2>

    <div class="centered-div">
        <!-- Toggle button -->
        <button id="toggleButton" class="stopped"></button>
    </div>
    <audio id="audioPlayer" preload="none">
        <source id="audioSource" src="https://s5.radio.co/scb89aab9c/listen" type="audio/mp3">
        Your browser does not support the audio element.
    </audio>

    <script>
        const toggleButton = document.getElementById('toggleButton');
        const audioPlayer = document.getElementById('audioPlayer');
        const audioSource = document.getElementById('audioSource');

        let isPlaying = false;

        // Function to restart the stream
        function restartStream() {
            if (isPlaying) {
                audioPlayer.pause();
                audioPlayer.load();  // This is necessary to re-fetch the stream
                audioPlayer.play().catch(error => {
                    console.log('An error occurred:', error);
                });
            }
        }

        // Add event listeners to the audio element
        audioPlayer.addEventListener('error', restartStream);
        audioPlayer.addEventListener('stalled', restartStream);
        audioPlayer.addEventListener('suspend', restartStream);

        // Check if audio source is available
        fetch(audioSource.src)
        .then(response => {
            if (response.status === 200) {
                toggleButton.addEventListener('click', () => {
                    if (isPlaying) {
                        audioPlayer.pause();
                        isPlaying = false;
                        toggleButton.className = 'stopped';
                    } else {
                        toggleButton.className = 'loading';
                        audioPlayer.play()
                        .then(() => {
                            isPlaying = true;
                            toggleButton.className = 'playing';
                        })
                        .catch(error => {
                            toggleButton.className = 'stopped';
                            console.log('An error occurred:', error);
                        });
                    }
                });
            } else {
                alert('Audio source not available.');
            }
        })
        .catch(error => {
            alert('An error occurred: ' + error);
        });

        // Periodic check every minute (60,000 milliseconds)
        setInterval(() => {
            fetch(audioSource.src)
            .then(response => {
                if (response.status !== 200) {
                    restartStream();
                }
            })
            .catch(error => {
                console.log('An error occurred: ', error);
                restartStream();
            });
        }, 5000);
    </script>
</body>
</html>
